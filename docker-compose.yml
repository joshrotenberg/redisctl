services:
  redis-enterprise:
    image: ${REDIS_ENTERPRISE_IMAGE:-redislabs/redis:latest}
    platform: ${REDIS_ENTERPRISE_PLATFORM:-linux/amd64}
    container_name: redis-enterprise
    tty: true
    cap_add:
      - ALL
    ports:
      - "12000:12000"
      - "12001:12001"
      - "9443:9443"
      - "8443:8443"
    networks:
      - redisctl-network
    healthcheck:
      test: ["CMD", "curl", "-f", "-k", "https://localhost:9443/v1/bootstrap"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 10s
    environment:
      # Default credentials for manual initialization
      # Use redisctl enterprise bootstrap create-cluster after container starts
      REDIS_ENTERPRISE_USERNAME: "admin@redis.local"
      REDIS_ENTERPRISE_PASSWORD: "Redis123!"

  # Note: Auto-initialization removed - workflow commands not yet implemented
  # To initialize the cluster manually after starting:
  # docker exec -it redis-enterprise /opt/redislabs/bin/rladmin cluster create name docker-cluster username admin@redis.local password Redis123!
  # OR use redisctl:
  # export REDIS_ENTERPRISE_URL="https://localhost:9443"
  # export REDIS_ENTERPRISE_INSECURE="true"
  # redisctl enterprise bootstrap create-cluster --data '{"name":"docker-cluster","username":"admin@redis.local","password":"Redis123!"}'

networks:
  redisctl-network:
    driver: bridge
